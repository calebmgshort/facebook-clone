<%= link_to "Sign out", destroy_user_session_path, :method => :delete %>

<div>
  <h3>What's on your mind?</h3>
  <%= form_for :post, url: posts_path do |f| %>
    <%= f.text_area :text %>
    <%= hidden_field_tag 'return_url', request.original_url %>
    <%= f.submit "Post" %>
  <% end %>
</div>

<div>
  <% @posts.each do |post| %>

    <h3><%= post.email %></h3>
    <h5><%= post.created_at %></h5>
    <p><%= post.text %></p>

    Likes: <%= Like.where(post_id: post.id).count %>
    <% if Like.find_by(post_id: post.id, user_id: current_user.id).blank? %>
      <%= form_for :like, url: likes_path do |f| %>
        <%= f.hidden_field :post_id, :value => post.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= hidden_field_tag 'return_url', request.original_url %>
        <%= f.submit "Like" %>
      <% end %>
    <% else %> 
      <%= form_with url: '/likes/destroy' do |f| %>
        <%= f.hidden_field :post_id, :value => post.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= hidden_field_tag 'return_url', request.original_url %>
        <%= f.submit "Unlike" %>
      <% end %>
    <% end %>
    <!-- TODO: Add unlike functionality --> 

    <% post.comments.each do |comment| %>
      <h5><%= comment.user.email%></h5>
      <p><%= comment.text %></p>
    <% end %>

    <h4>Add new comment:</h4>
    <%= form_for :comment, url: comments_path do |f| %>
      <%= f.text_area :text %>
      <%= f.hidden_field :post_id, :value => post.id %>
      <%= hidden_field_tag 'return_url', request.original_url %>
      <%= f.submit "Comment" %>
    <% end %>
    
  <% end %>
</div>

<div>
  <h3>Your friends</h3>
  <ul>
    <% current_user.friends.each do |friend| %>
      <li>
        <%= friend['friend_email'] %>
        <%= form_with url: '/user_friend/remove_friend' do |f| %>
          <%= f.hidden_field :friend_id, :value => friend['friend_id'] %>
          <%= hidden_field_tag 'return_url', request.original_url %>
          <%= f.submit "Unfriend" %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div>
  <h3>Friend requests</h3>
  <ul>
    <% current_user.pending_friend_requests.each do |friend| %>
      <li>
        <%= friend['email'] %>
        <%= form_for :user_friend, url: '/user_friend/accept_friend' do |f| %>
          <%= f.hidden_field :requester_id, :value => friend['id'] %>
          <%= hidden_field_tag 'return_url', request.original_url %>
          <%= f.submit "Accept" %>
        <% end %>
        <%= form_for :user_friend, url: '/user_friend/reject_friend' do |f| %>
          <%= f.hidden_field :requester_id, :value => friend['id'] %>
          <%= hidden_field_tag 'return_url', request.original_url %>
          <%= f.submit "Reject" %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div>
  <h3>Suggested friends</h3>
  <ul>
    <% current_user.suggested_friends.each do |suggestion| %>
      <li>
        <%= suggestion['email'] %>
        <%= form_for :user_friend, url: '/user_friend/request_friend' do |f| %>
          <%= f.hidden_field :requestee_id, :value => suggestion['id'] %>
          <%= hidden_field_tag 'return_url', request.original_url %>
          <%= f.submit "Request friend" %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>
